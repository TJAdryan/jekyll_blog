<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Identifying Microsoft Teams Storage Usage with Python and Graph API" />
<meta property="og:locale" content="en" />
<meta name="description" content="I usually have a hard time learning something when the information is completely abstract I much prefer a practical application. I don’t want to expose the internal workings of any of my clients. So this is something I have run, with ‘fictitious’ data. In this case we are going to use the example of a school. We’ll compare synchronous and async code in the Microsoft Graph API to get a list of all the teams in the organization and then get the storage usage for each team. The school has run out out of data and needs to find out how much space is being used by each team." />
<meta property="og:description" content="I usually have a hard time learning something when the information is completely abstract I much prefer a practical application. I don’t want to expose the internal workings of any of my clients. So this is something I have run, with ‘fictitious’ data. In this case we are going to use the example of a school. We’ll compare synchronous and async code in the Microsoft Graph API to get a list of all the teams in the organization and then get the storage usage for each team. The school has run out out of data and needs to find out how much space is being used by each team." />
<link rel="canonical" href="https://nextvaldata.com/development/administration/2024/07/10/All-the-Teams-Storage.html" />
<meta property="og:url" content="https://nextvaldata.com/development/administration/2024/07/10/All-the-Teams-Storage.html" />
<meta property="og:site_name" content="NextValData" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-10T12:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Identifying Microsoft Teams Storage Usage with Python and Graph API" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-10T12:00:00-04:00","datePublished":"2024-07-10T12:00:00-04:00","description":"I usually have a hard time learning something when the information is completely abstract I much prefer a practical application. I don’t want to expose the internal workings of any of my clients. So this is something I have run, with ‘fictitious’ data. In this case we are going to use the example of a school. We’ll compare synchronous and async code in the Microsoft Graph API to get a list of all the teams in the organization and then get the storage usage for each team. The school has run out out of data and needs to find out how much space is being used by each team.","headline":"Identifying Microsoft Teams Storage Usage with Python and Graph API","mainEntityOfPage":{"@type":"WebPage","@id":"https://nextvaldata.com/development/administration/2024/07/10/All-the-Teams-Storage.html"},"url":"https://nextvaldata.com/development/administration/2024/07/10/All-the-Teams-Storage.html"}</script>
<!-- End Jekyll SEO tag -->


  <title>Identifying Microsoft Teams Storage Usage with Python and Graph API | NextValData
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="NextValData">
<meta name="application-name" content="NextValData">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicon.ico" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">NextValData</a>
    <p class="site-subtitle fst-italic mb-0">Sequential sense is better than nonsense</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/tjadryan"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['dominick','nextvaldata.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
        
          
        
          
        
          
        
          
            
              <span>Identifying Microsoft Teams Storage Usage with Python and Graph API</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Identifying Microsoft Teams Storage Usage with Python and Graph API</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1720627200"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jul 10, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/tjadryan">Dominick Ryan</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1499 words"
>
  <em>8 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Identifying Microsoft Teams Storage Usage with Python and Graph API</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Identifying Microsoft Teams Storage Usage with Python and Graph API</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <p>I usually have a hard time learning something when the information is completely abstract I much prefer a practical application. I don’t want to expose the internal workings of any of my clients. So this is something I have run, with ‘fictitious’ data. In this case we are going to use the example of a school. We’ll compare synchronous and async code in the Microsoft Graph API to get a list of all the teams in the organization and then get the storage usage for each team.  The school has run out out of data and needs to find out how much space is being used by each team.</p>

<h2 id="prerequisites"><span class="me-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Before starting, ensure you have the following:</p>

<ul>
  <li>Python 3.7+</li>
  <li>The following Python libraries: <code class="language-plaintext highlighter-rouge">requests</code>, <code class="language-plaintext highlighter-rouge">msal</code>, <code class="language-plaintext highlighter-rouge">pandas</code>, <code class="language-plaintext highlighter-rouge">aiohttp</code>, <code class="language-plaintext highlighter-rouge">nest_asyncio</code>. Install them via pip:
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  pip <span class="nb">install </span>requests msal pandas aiohttp nest_asyncio
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>An Azure Active Directory (Azure AD) application registration with:
    <ul>
      <li>Client ID</li>
      <li>Tenant ID</li>
      <li>A generated Client Secret</li>
      <li>The following Microsoft Graph API <strong>Application Permissions</strong> (admin consent granted):
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Group.Read.All</code> (to list Teams)</li>
          <li><code class="language-plaintext highlighter-rouge">Sites.Read.All</code> (to access drive storage information)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Security Note:</strong> Securely manage your <code class="language-plaintext highlighter-rouge">client_secret</code>. Avoid hardcoding it in scripts for production environments. Consider using an environment variable.</p>

<h2 id="python-script-walkthrough"><span class="me-2">Python Script Walkthrough</span><a href="#python-script-walkthrough" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="part-1-authentication-with-msal"><span class="me-2">Part 1: Authentication with MSAL</span><a href="#part-1-authentication-with-msal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>We use the Microsoft Authentication Library (MSAL) for Python to obtain an access token for the Graph API. The token is good for an hour. Plenty of time for what we are doing here. I like to put into function anyway, you don’t know when you will need it again.  Which is the whole point of functions, right?</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">msal</span> <span class="kn">import</span> <span class="n">ConfidentialClientApplication</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">sleep</span>  <span class="c1"># Optional for deliberate delays
</span>
<span class="c1"># --- Credentials - Replace with your actual values ---
</span><span class="n">client_id</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YOUR_CLIENT_ID</span><span class="sh">'</span>
<span class="n">tenant_id</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YOUR_TENANT_ID</span><span class="sh">'</span>
<span class="n">client_secret</span> <span class="o">=</span> <span class="sh">'</span><span class="s">YOUR_CLIENT_SECRET</span><span class="sh">'</span>
<span class="c1"># --- End Credentials ---
</span>
<span class="n">msal_authority</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">https://login.microsoftonline.com/</span><span class="si">{</span><span class="n">tenant_id</span><span class="si">}</span><span class="sh">"</span>
<span class="n">msal_scope</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">https://graph.microsoft.com/.default</span><span class="sh">"</span><span class="p">]</span>

<span class="n">msal_app</span> <span class="o">=</span> <span class="nc">ConfidentialClientApplication</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
    <span class="n">client_credential</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
    <span class="n">authority</span><span class="o">=</span><span class="n">msal_authority</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">update_headers</span><span class="p">(</span><span class="n">current_msal_app</span><span class="p">,</span> <span class="n">current_msal_scope</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Acquires a Graph API token and returns request headers.</span><span class="sh">"""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">current_msal_app</span><span class="p">.</span><span class="nf">acquire_token_silent</span><span class="p">(</span>
        <span class="n">scopes</span><span class="o">=</span><span class="n">current_msal_scope</span><span class="p">,</span>
        <span class="n">account</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># print("No token in cache, acquiring new token for client...") # Optional logging
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">current_msal_app</span><span class="p">.</span><span class="nf">acquire_token_for_client</span><span class="p">(</span><span class="n">scopes</span><span class="o">=</span><span class="n">current_msal_scope</span><span class="p">)</span>

    <span class="k">if</span> <span class="sh">"</span><span class="s">access_token</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">access_token</span><span class="sh">"</span><span class="p">]</span>
        <span class="c1"># print('Token acquired successfully.') # Optional logging
</span>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">headers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_description</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">error_description</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">No error description provided.</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error acquiring token: </span><span class="si">{</span><span class="n">error_description</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">No Access Token found or error in acquiring token.</span><span class="sh">"</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="nf">update_headers</span><span class="p">(</span><span class="n">msal_app</span><span class="p">,</span> <span class="n">msal_scope</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The update_headers function handles token acquisition.</p>

<h3 id="part-2-fetching-all-microsoft-teams"><span class="me-2">Part 2: Fetching All Microsoft Teams</span><a href="#part-2-fetching-all-microsoft-teams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Teams are Microsoft 365 Groups with a ‘Team’ resource. We query the Graph API for these groups. We will run this synchonously it returs the list relatively quickly in about 3 seconds.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="n">teams_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://graph.microsoft.com/v1.0/groups?$filter=resourceProvisioningOptions/Any(x:x eq </span><span class="sh">'</span><span class="s">Team</span><span class="sh">'</span><span class="s">)&amp;$select=id,displayName</span><span class="sh">"</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Fetching list of all Teams...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">start_fetch_teams_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="n">all_teams_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_url</span> <span class="o">=</span> <span class="n">teams_url</span>

<span class="k">while</span> <span class="n">current_url</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">current_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span> 
    <span class="n">teams_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    
    <span class="n">all_teams_list</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">teams_data</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">current_url</span> <span class="o">=</span> <span class="n">teams_data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">@odata.nextLink</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> 
    <span class="c1"># if current_url: # Optional logging
</span>    <span class="c1">#     print(f"Fetching next page of teams...")
</span>
<span class="n">df_teams</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">all_teams_list</span><span class="p">)</span>
<span class="n">df_unique_teams</span> <span class="o">=</span> <span class="n">df_teams</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="sh">'</span><span class="s">first</span><span class="sh">'</span><span class="p">)</span>

<span class="n">end_fetch_teams_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">elapsed_fetch_teams_time</span> <span class="o">=</span> <span class="n">end_fetch_teams_time</span> <span class="o">-</span> <span class="n">start_fetch_teams_time</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Found </span><span class="si">{</span><span class="n">df_unique_teams</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> unique Teams.</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Time to fetch Teams list: </span><span class="si">{</span><span class="n">elapsed_fetch_teams_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds</span><span class="sh">"</span><span class="p">)</span>

<span class="n">team_ids_list</span> <span class="o">=</span> <span class="n">df_unique_teams</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">].</span><span class="nf">tolist</span><span class="p">()</span>
<span class="n">team_names_list</span> <span class="o">=</span> <span class="n">df_unique_teams</span><span class="p">[</span><span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">].</span><span class="nf">tolist</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>After running this code, you’ll get a list of teams like this, we really only need the id, but the displayName is nice to have and shows us right away that one of the names is repeated, but has a different id.  This is a good example of why you should always check for duplicates when working with data.  Seems like a strong hint, but I think we all already know who is responsible::</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1"># Example of teams data from Graph API:
</span><span class="p">[</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">87w3uhq2ev99r123o5mwi55s6nqp2bk4zlwf</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Shell Cottage</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">qq9dqz35wgdq8yqjrn5wt4sqzzgpuihbbvas</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Gryffindor Common Room</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ly09hvq87rvxh0n1rxh83d2vnaraqy7zpxuu</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Hufflepuff House</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">38tcpukusneqdhnwconcflwt2dqsgiobrbj4</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Black Lake</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">tsafap1hyai38knuc3p8sgmzafdt7pqq1o9u</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Dungeons</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">z98u31nua35b499cbqi8hy3gzyytad4z9mxb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Library</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">s50u5ipnrukdp4pnrgk0g1fk4bpq0mzkpmms</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Azkaban Prison</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">dsos1aq9517gwnavr0c8miz5xrzhc9iq4jce</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Library</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">usrpwr65bj18zmrk8hqqmyaryglyop8dh0x6</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">The Hufflepuff Common Room</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">no12n4fddxtoq5sddz7c0ej0q35nctjreyv7</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">displayName</span><span class="sh">'</span><span class="p">:</span> <span class="sh">"</span><span class="s">St. Mungo</span><span class="sh">'</span><span class="s">s Hospital</span><span class="sh">"</span><span class="p">}</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></div></div>
<h2 id="part-3-fetching-drive-storage-synchronous-method"><span class="me-2">Part 3: Fetching Drive Storage (Synchronous Method)</span><a href="#part-3-fetching-drive-storage-synchronous-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>This initial approach fetches storage information for each Team sequentially. It can be slow, especially if you have a large number of teams.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Fetching drive storage for each team (Synchronous approach)...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sync_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="n">all_teams_drive_data_sync</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Consider token refresh strategy for very long running synchronous operations.
# headers = update_headers(msal_app, msal_scope) 
</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">teamid</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">team_ids_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Progress indicator, skip first
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing team </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">team_ids_list</span><span class="p">)</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">team_names_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">drive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">https://graph.microsoft.com/v1.0/groups/</span><span class="si">{</span><span class="n">teamid</span><span class="si">}</span><span class="s">/drive</span><span class="sh">'</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">drive_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>
        <span class="n">drive_info</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="n">team_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">json_normalize</span><span class="p">(</span><span class="n">drive_info</span><span class="p">)</span>
        <span class="n">team_frame</span><span class="p">[</span><span class="sh">'</span><span class="s">team_id</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">teamid</span>
        <span class="n">team_frame</span><span class="p">[</span><span class="sh">'</span><span class="s">teamName</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_names_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">all_teams_drive_data_sync</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">team_frame</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error fetching drive for team ID </span><span class="si">{</span><span class="n">teamid</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">team_names_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s">): </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="p">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error decoding JSON for team ID </span><span class="si">{</span><span class="n">teamid</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">team_names_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">An unexpected error for team ID </span><span class="si">{</span><span class="n">teamid</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">team_names_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># time.sleep(0.05) # Optional small delay for very basic throttling avoidance
</span>
<span class="k">if</span> <span class="n">all_teams_drive_data_sync</span><span class="p">:</span>
    <span class="n">space_teams_sync_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">coI</span> <span class="n">didn</span><span class="sh">'</span><span class="s">t dive into thencat(all_teams_drive_data_sync, ignore_index=True)
    print(f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Synchronous fetching processed {len(space_teams_sync_df)} team drives.</span><span class="sh">"</span><span class="s">)
else:
    print(</span><span class="sh">"</span><span class="se">\n</span><span class="s">No drive data fetched synchronously.</span><span class="sh">"</span><span class="s">)
    space_teams_sync_df = pd.DataFrame()

sync_end_time = time.time()
sync_elapsed_time = sync_end_time - sync_start_time
print(f</span><span class="sh">"</span><span class="s">Execution time for synchronous drive fetching: {sync_elapsed_time:.2f} seconds</span><span class="sh">"</span><span class="s">)
# print(space_teams_sync_df.head() if not space_teams_sync_df.empty else </span><span class="sh">"</span><span class="s">No sync data to show.</span><span class="sh">"</span><span class="s">)
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="part-4-asynchronous-data-fetching-with-aiohttp"><span class="me-2">Part 4: Asynchronous Data Fetching with aiohttp</span><a href="#part-4-asynchronous-data-fetching-with-aiohttp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>To improve performance, we use aiohttp and asyncio for concurrent API calls.
nest_asyncio is only neccesary if you are running this in a jupyter notebook. 
You might not even need this if you are running jupyter 7.</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">aiohttp</span>
<span class="kn">import</span> <span class="n">nest_asyncio</span> 

<span class="n">nest_asyncio</span><span class="p">.</span><span class="nf">apply</span><span class="p">()</span> 

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_drive_async</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">teamid</span><span class="p">,</span> <span class="n">team_name</span><span class="p">,</span> <span class="n">auth_headers</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Asynchronously fetches drive information for a single team.</span><span class="sh">"""</span>
    <span class="n">drive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">https://graph.microsoft.com/v1.0/groups/</span><span class="si">{</span><span class="n">teamid</span><span class="si">}</span><span class="s">/drive</span><span class="sh">'</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">drive_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">auth_headers</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
                <span class="k">if</span> <span class="sh">'</span><span class="s">quota</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">used</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">quota</span><span class="sh">'</span><span class="p">]:</span>
                    <span class="n">team_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">team_frame</span><span class="p">[</span><span class="sh">'</span><span class="s">team_id</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">teamid</span>
                    <span class="n">team_frame</span><span class="p">[</span><span class="sh">'</span><span class="s">teamName</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
                    <span class="k">return</span> <span class="n">team_frame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># print(f"Warning: 'quota.used' not found for team {team_name} ({teamid}).") # Optional
</span>                    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">team_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">teamid</span><span class="p">],</span> <span class="sh">'</span><span class="s">teamName</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">team_name</span><span class="p">],</span> <span class="sh">'</span><span class="s">quota.used</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span> <span class="sh">'</span><span class="s">error_detail</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Missing quota info</span><span class="sh">'</span><span class="p">]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># print(f"Error (async) for team {team_name} ({teamid}): {response.status}") # Optional
</span>                <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">team_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">teamid</span><span class="p">],</span> <span class="sh">'</span><span class="s">teamName</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">team_name</span><span class="p">],</span> <span class="sh">'</span><span class="s">error_status</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">.</span><span class="n">status</span><span class="p">]})</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># print(f"Exception (async) for team {team_name} ({teamid}): {e}") # Optional
</span>        <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">team_id</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">teamid</span><span class="p">],</span> <span class="sh">'</span><span class="s">teamName</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">team_name</span><span class="p">],</span> <span class="sh">'</span><span class="s">exception</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)]})</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main_async_fetch</span><span class="p">(</span><span class="n">team_ids</span><span class="p">,</span> <span class="n">team_names_list_async</span><span class="p">,</span> <span class="n">auth_headers</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Main async function to gather drive information for all teams.</span><span class="sh">"""</span>
    <span class="n">all_teams_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># For very large tenants, consider an asyncio.Semaphore to limit concurrency:
</span>    <span class="c1"># sem = asyncio.Semaphore(10) # Limit to 10 concurrent requests
</span>    <span class="c1"># async with sem:
</span>    <span class="c1">#     tasks.append(fetch_drive_async(session, teamid, team_names_list_async[i], auth_headers))
</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="p">.</span><span class="nc">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">teamid</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">team_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Progress indicator
</span>                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Queueing async fetch for team </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">team_ids</span><span class="p">)</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">team_names_list_async</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">tasks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">fetch_drive_async</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">teamid</span><span class="p">,</span> <span class="n">team_names_list_async</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">auth_headers</span><span class="p">))</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">all_teams_data</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">A task failed with exception: </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">all_teams_data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_teams_data</span> <span class="k">else</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Fetching drive storage for each team (Asynchronous approach)...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">current_headers</span> <span class="o">=</span> <span class="nf">update_headers</span><span class="p">(</span><span class="n">msal_app</span><span class="p">,</span> <span class="n">msal_scope</span><span class="p">)</span> <span class="c1"># Refresh token
</span>
<span class="n">async_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">space_teams_async_df</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main_async_fetch</span><span class="p">(</span><span class="n">team_ids_list</span><span class="p">,</span> <span class="n">team_names_list</span><span class="p">,</span> <span class="n">current_headers</span><span class="p">))</span>
<span class="n">async_end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">async_elapsed_time</span> <span class="o">=</span> <span class="n">async_end_time</span> <span class="o">-</span> <span class="n">async_start_time</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Asynchronous fetching complete.</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Execution time for asynchronous drive fetching: </span><span class="si">{</span><span class="n">async_elapsed_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># print(space_teams_async_df.head() if not space_teams_async_df.empty else "No async data to show.")
</span></pre></td></tr></tbody></table></code></div></div>

<h1 id="synchronous-approach-results">Synchronous approach results:</h1>
<p>Synchronous fetching processed 535 team drives.
Data shape: (535, 10)
Execution time for synchronous drive fetching: 186.42 seconds</p>

<h1 id="asynchronous-approach-results">Asynchronous approach results:</h1>
<p>Asynchronous fetching complete.
Data shape: (535, 10)
Execution time for asynchronous drive fetching: 2.94 seconds</p>

<p>So there you go, the async approach returns the same data, just more than 60 times faster.  We didn’t dive into the data this time, so I will tell you it was the Library that was using the most space.  I almost feel bad for thinking it was Slytetherin, lazy thinking on my part.</p>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/development/">Development</a>,
          <a href="/categories/administration/">Administration</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/python/"
            class="post-tag no-text-decoration"
          >python</a>
        
          <a
            href="/tags/microsoft-graph/"
            class="post-tag no-text-decoration"
          >microsoft-graph</a>
        
          <a
            href="/tags/teams/"
            class="post-tag no-text-decoration"
          >teams</a>
        
          <a
            href="/tags/admin/"
            class="post-tag no-text-decoration"
          >admin</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Identifying%20Microsoft%20Teams%20Storage%20Usage%20with%20Python%20and%20Graph%20API%20-%20NextValData&u=https%3A%2F%2Fnextvaldata.com%2Fdevelopment%2Fadministration%2F2024%2F07%2F10%2FAll-the-Teams-Storage.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fnextvaldata.com%2Fdevelopment%2Fadministration%2F2024%2F07%2F10%2FAll-the-Teams-Storage.html&text=Identifying%20Microsoft%20Teams%20Storage%20Usage%20with%20Python%20and%20Graph%20API%20-%20NextValData" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/python/performance/apis/dataengineering/orjson/optimization/2025/07/19/Taking-the-Small-Wins.html">Taking the Small Wins: How Incremental Improvements Cut My API Call Times from 70 to 45 Minutes</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/data%20engineering/python/orchestration/2025/06/29/Better-Pipelines-with-Dagster.html">Building Data Pipelines with Dagster: Practical</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/data%20engineering/python/api/2025/06/14/Bring-me-the-Data.html">Bring me the Data</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/data%20engineering/python/2025/06/08/DuckDB-Diners-Drives-and-Databases-PartII.html">DuckDB - Diners, Drives, and Databases Part II</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/data%20engineering/python/2025/06/06/DuckDB-Diners-Drives-and-Databases.html">DuckDB - Diners, Drives, and Databases Part I</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/data-analysis/">data analysis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pandas/">Pandas</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/testing/">testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api/">API</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/duckdb/">DuckDB</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/excel/">excel</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sql/">SQL</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/technology/science/2025/05/15/Sometimes-Good-Things-Happen.html" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1747324800"
  data-df="ll"
  
>
  May 15, 2025
</time>

              <h4 class="pt-0 my-2">The Legend of CRISPR: Long Ago and Far Away a Young Prokaryote...</h4>
              <div class="text-muted">
                <p>Sort of a fairytale… Almost everything about CRISPR sounds magical, even its origins.  Some of the first living organisms, are attacked by viruses, few survive. Some evolve an ability that allows t...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/technology/data/2024/06/05/xml-all-the-things.html" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1717603200"
  data-df="ll"
  
>
  Jun  5, 2024
</time>

              <h4 class="pt-0 my-2">XLSX are Just Text Files in a Trench Coat</h4>
              <div class="text-muted">
                <p>It’s XML All the Way Down  A few years ago I was tasked to use an API with poor documentation that was only available in SOAP. Fortunately, there is a Python library called Zeep (docs.python-zeep.o...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/development/automation/databases/2025/05/26/Automated-SQL-Backups-to-Google-Drive.html" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1748275200"
  data-df="ll"
  
>
  May 26, 2025
</time>

              <h4 class="pt-0 my-2">Automated SQL Backups to Google Drive with Python</h4>
              <div class="text-muted">
                <p>Protecting your data is crucial, and having automated backups is a cornerstone of any robust data strategy. In this post, I’ll walk you through a Python script that automatically backs up your SQL ...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/technology/data/2024/06/05/xml-all-the-things.html"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>XLSX are Just Text Files in a Trench Coat</p>
    </a>
  

  
    <a
      href="/development/data/2024/07/18/If-you-have-to.html"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>If You Have To Use Excel, Automate It: Formatting with Python</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/tjadryan">Dominick Ryan</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.3.0"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/data-analysis/">data analysis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pandas/">Pandas</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/testing/">testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api/">API</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/duckdb/">DuckDB</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/excel/">excel</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sql/">SQL</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

